# Profile DEV: MySQL local + listeners Kafka encendidos

# Datasource MySQL
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/catalogue?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC}
spring.datasource.driver-class-name=${SPRING_DATASOURCE_DRIVER_CLASS_NAME:com.mysql.cj.jdbc.Driver}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:password}

# Datasource H2 (deshabilitado)
# spring.datasource.url=jdbc:h2:mem:catalogue;MODE=MySQL;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1;DATABASE_TO_LOWER=TRUE
# spring.datasource.driver-class-name=org.h2.Driver
# spring.datasource.username=sa
# spring.datasource.password=

# JPA/Hibernate para MySQL
spring.jpa.database-platform=${SPRING_JPA_DATABASE_PLATFORM:org.hibernate.dialect.MySQL8Dialect}
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=${SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL:true}
spring.jpa.defer-datasource-initialization=${SPRING_JPA_DEFER_DATASOURCE_INITIALIZATION:false}

# Ejecutar scripts SQL (deshabilitado para MySQL por defecto)
spring.sql.init.mode=${SPRING_SQL_INIT_MODE:never}
# spring.sql.init.data-locations=classpath:data-h2.sql

# Console H2 (deshabilitada)
spring.h2.console.enabled=${SPRING_H2_CONSOLE_ENABLED:false}
# spring.h2.console.path=/h2-console

# Kafka: iniciar listeners en dev
spring.kafka.listener.auto-startup=${SPRING_KAFKA_LISTENER_AUTO_STARTUP:true}
spring.kafka.bootstrap-servers=${SPRING_KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.consumer.group-id=${SPRING_KAFKA_CONSUMER_GROUP_ID:inventario-ms}

# Inventario: topic de consumo (desde Ventas)
inventario.kafka.enabled=${INVENTARIO_KAFKA_ENABLED:true}
inventario.kafka.topic=${INVENTARIO_KAFKA_TOPIC:ventas}
inventario.kafka.concurrency=${INVENTARIO_KAFKA_CONCURRENCY:3}
inventario.kafka.error.maxAttempts=${INVENTARIO_KAFKA_ERROR_MAXATTEMPTS:2}
inventario.kafka.error.backoff.ms=${INVENTARIO_KAFKA_ERROR_BACKOFF_MS:500}

# Inventario: topic para consumidor especializado de Ventas
inventario.kafka.sales-topic=${INVENTARIO_KAFKA_SALES_TOPIC:ventas}

# Server
server.port=${SERVER_PORT:${PORT:5000}}
server.servlet.context-path=${SERVER_SERVLET_CONTEXT_PATH:/api}

# Communication (middleware)
communication.intermediary.url=${COMMUNICATION_INTERMEDIARY_URL:http://localhost:8090}

# Keycloak (client_credentials)
keycloak.token.url=${KEYCLOAK_TOKEN_URL:http://localhost:8080/realms/ecommerce/protocol/openid-connect/token}
keycloak.client-id=${KEYCLOAK_CLIENT_ID:storage-app}
keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET}
keycloak.refresh.enabled=${KEYCLOAK_REFRESH_ENABLED:false}

# =========================
# Variables de entorno (ejemplo/local)
# =========================
# --- MySQL (activo) ---
# SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3306/catalogue?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
# SPRING_DATASOURCE_DRIVER_CLASS_NAME=com.mysql.cj.jdbc.Driver
# SPRING_DATASOURCE_USERNAME=root
# SPRING_DATASOURCE_PASSWORD=password
# SPRING_JPA_DATABASE_PLATFORM=org.hibernate.dialect.MySQL8Dialect
# SPRING_JPA_HIBERNATE_DDL_AUTO=update
# SPRING_JPA_SHOW_SQL=true
# SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL=true
# SPRING_JPA_DEFER_DATASOURCE_INITIALIZATION=false
# SPRING_SQL_INIT_MODE=never
# SPRING_H2_CONSOLE_ENABLED=false

# --- Kafka ---
# SPRING_KAFKA_LISTENER_AUTO_STARTUP=true
# SPRING_KAFKA_BOOTSTRAP_SERVERS=localhost:9092
# SPRING_KAFKA_CONSUMER_GROUP_ID=inventario-ms
# INVENTARIO_KAFKA_ENABLED=true
# INVENTARIO_KAFKA_TOPIC=ventas
# INVENTARIO_KAFKA_CONCURRENCY=3
# INVENTARIO_KAFKA_ERROR_MAXATTEMPTS=2
# INVENTARIO_KAFKA_ERROR_BACKOFF_MS=500
# INVENTARIO_KAFKA_SALES_TOPIC=ventas

# --- Server & otros ---
# SERVER_PORT=5000
# SERVER_SERVLET_CONTEXT_PATH=/api
# COMMUNICATION_INTERMEDIARY_URL=http://localhost:8090

# --- Keycloak (client_credentials) ---
# KEYCLOAK_TOKEN_URL=http://localhost:8080/realms/ecommerce/protocol/openid-connect/token
# KEYCLOAK_CLIENT_ID=storage-app
# KEYCLOAK_CLIENT_SECRET=<definir_en_entorno>
# KEYCLOAK_REFRESH_ENABLED=false

# --- H2 (deshabilitado) ---
# SPRING_SQL_INIT_DATA_LOCATIONS=classpath:data-h2.sql
# SPRING_DATASOURCE_URL=jdbc:h2:mem:catalogue;MODE=MySQL;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1;DATABASE_TO_LOWER=TRUE
# SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.h2.Driver
# SPRING_DATASOURCE_USERNAME=sa
# SPRING_DATASOURCE_PASSWORD=
# SPRING_H2_CONSOLE_PATH=/h2-console